<!DOCTYPE html>
<html lang="fr">
  <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" name="viewport"/>
  <meta content="#fde7f3" name="theme-color"/>
  
  <meta content="default-src 'self' data: gap: 'unsafe-eval' 'unsafe-inline'; style-src 'self' 'unsafe-inline'; font-src 'self'; media-src *; img-src 'self' data: content: https://placehold.co;" http-equiv="Content-Security-Policy"/>
  
  <title>
   U-AUBEN INVENTORY
  </title>

  <script src="js/tailwind.js"></script>
  <script src="js/lucide.min.js"></script>
  
  <script src="js/marked.min.js"></script>
  <script src="js/db.js"></script>

  <style>
   /* Police système propre pour tablette (évite les erreurs de dossiers fonts manquants) */
        body { 
            font-family: system-ui, -apple-system, sans-serif; 
            -webkit-tap-highlight-color: transparent; 
            margin: 0; 
            background-color: #fde7f3;
            min-height: 100vh;
        }

        /* Structure de l'application */
        .main-container {
            width: 100%; 
            min-height: 100vh;
            display: flex; 
            flex-direction: column;
            background-color: #fde7f3;
            background-image: radial-gradient(#e5e7eb 0.5px, transparent 0.5px);
            background-size: 20px 20px;
            position: relative; 
            overflow-x: hidden;
        }

        /* Classes utilitaires personnalisées */
        .font-algerian { font-family: 'serif'; font-weight: bold; }
        .font-monotype-corsiva { font-family: 'cursive'; }

        /* Correction pour les boutons tactiles sur tablette */
        button {
            touch-action: manipulation;
            cursor: pointer;
        }

        /* Sécurité : cache les éléments par défaut avant le chargement de Tailwind */
        .hidden { display: none !important; }
  </style>

    <script>
    // 1. CONFIGURATION TAILWIND
    tailwind.config = {
      theme: { extend: { colors: { 'aube-red': '#b91c1c', 'aube-blue': '#1e3a8a' } } }
    }

    // 2. MOTEUR DE NAVIGATION UNIVERSEL
    let navigationHistory = ['screen-blocA']; 

    function showScreen(screenId, saveHistory = true) {
        console.log("Navigation vers :", screenId);
        
        // Cible absolument toutes les sections qui sont des écrans
        const allScreens = document.querySelectorAll('.main-container > div');
        allScreens.forEach(s => s.classList.add('hidden'));

        const target = document.getElementById(screenId);
        if (target) {
            target.classList.remove('hidden');
            if (saveHistory && navigationHistory[navigationHistory.length - 1] !== screenId) {
                navigationHistory.push(screenId);
            }
            window.scrollTo(0, 0);
            // Relancer les icônes si un nouvel écran apparaît
            if (window.lucide) { window.lucide.createIcons(); }
        } else {
            console.error("Écran introuvable dans le HTML :", screenId);
        }
    }

    // FONCTIONS D'ACCÈS AUX BLOCS ET SUBDIVISIONS
    function showBlocDetails(letter) { 
        // Tente l'ID formaté par Manus ou l'original
        showScreen('screen-bloc' + letter + '-details'); 
    }

    function showSubBlocDetails(id) { 
        showScreen('screen-bloc' + id + '-levels'); 
    }

    function navigateTo(id) { 
        showScreen(id); 
    }
    
    function goBack() {
        if (navigationHistory.length > 1) {
            navigationHistory.pop();
            showScreen(navigationHistory[navigationHistory.length - 1], false);
        } else {
            showScreen('screen-blocA', false);
        }
    }

    // GESTION DU MENU ET DES PARAMÈTRES
    function toggleMenu(isOpen) {
        const sideMenu = document.getElementById('side-menu');
        const overlay = document.getElementById('menu-overlay');
        if (sideMenu && overlay) {
            if (isOpen) {
                sideMenu.style.transform = 'translateX(0)';
                overlay.classList.remove('hidden');
            } else {
                sideMenu.style.transform = 'translateX(-100%)';
                overlay.classList.add('hidden');
            }
        }
    }

    function promptForPassword() {
        const pass = prompt("Entrez le code administrateur :");
        if (pass === "1234") { // Change le code si nécessaire
            showScreen('screen-settings');
        } else {
            alert("Code incorrect");
        }
    }

    // 3. INITIALISATION
    document.addEventListener('DOMContentLoaded', () => {
        if (window.lucide) { window.lucide.createIcons(); }
        // On démarre sur ton accueil réel
        showScreen('screen-blocA', false);
    });
    </script>
  </head>
<body class="bg-gray-200">

    <div id="main-app-container" class="main-container">
        <!-- Chaque "écran" est un div que nous allons montrer/cacher -->

        <!-- Écran: Accueil -->
        <div id="screen-blocA" class="flex flex-col h-full">
            <!-- Header -->
            <div class="flex-shrink-0 px-4 pt-4 z-10">
                <div class="bg-red-700 text-white rounded-full flex justify-between items-center p-3 shadow-md" style="background-color: #b91c1c;">
                    <button onclick="toggleMenu()" class="text-white"><i data-lucide="menu"></i></button>
                    <h1 class="font-semibold text-sm">&nbsp;</h1>
                    <button onclick="promptForPassword()" class="text-white"><i data-lucide="sliders-horizontal"></i></button>
                </div>
            </div>

            <!-- Main Content (scrollable) -->
            <!-- MODIFICATION: pb-nav supprimé -->
            <div class="flex-grow overflow-y-auto px-4">
                 <div class="relative my-4">
                    <input type="search" id="search-input" placeholder="Que cherchez vous aujourd’hui ?" class="w-full bg-white rounded-full pl-10 pr-12 py-2 border-2 border-gray-200 focus:outline-none focus:border-blue-500 shadow-inner">
                    <i data-lucide="search" class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 w-5 h-5"></i>
                    <button onclick="navigateTo('screen-chat-aube')" class="absolute right-4 top-1/2 -translate-y-1/2 text-blue-600 hover:text-blue-800">
                        <i data-lucide="bot"></i>
                    </button>
                    <div id="search-suggestions" class="absolute top-full left-0 right-0 mt-2 bg-white rounded-xl shadow-lg z-20 hidden overflow-hidden">
                    </div>
                </div>

                <div class="bg-blue-900 rounded-2xl p-2 flex items-center space-x-2 text-center mb-4 shadow-lg overflow-x-auto no-scrollbar" style="background-color: #1e3a8a;">
                    <button onclick="showBlocDetails('A')" class="text-white py-2 px-4 text-xs font-semibold bg-white/10 hover:bg-white/20 rounded-lg transition-colors flex-shrink-0">Bloc A</button>
                    <button onclick="showBlocDetails('B')" class="text-white py-2 px-4 text-xs font-semibold bg-white/10 hover:bg-white/20 rounded-lg transition-colors flex-shrink-0">Bloc B</button>
                    <button onclick="showBlocDetails('C')" class="text-white py-2 px-4 text-xs font-semibold bg-white/10 hover:bg-white/20 rounded-lg transition-colors flex-shrink-0">Bloc C</button>
                    <button onclick="showBlocDetails('D')" class="text-white py-2 px-4 text-xs font-semibold bg-white/10 hover:bg-white/20 rounded-lg transition-colors flex-shrink-0">Bloc D</button>
                    <button onclick="showBlocDetails('E')" class="text-white py-2 px-4 text-xs font-semibold bg-white/10 hover:bg-white/20 rounded-lg transition-colors flex-shrink-0">Bloc E</button>
                    <button onclick="showBlocDetails('F')" class="text-white py-2 px-4 text-xs font-semibold bg-white/10 hover:bg-white/20 rounded-lg transition-colors flex-shrink-0">Bloc F</button>
                </div>

                <div class="bg-white rounded-3xl shadow-lg overflow-hidden mb-4">
                    <img id="main-building-image" src="https://placehold.co/400x220/3b82f6/ffffff?text=Universit%C3%A9" alt="Bâtiment Universitaire" class="w-full h-auto object-cover">
                </div>

                <div class="text-center">
                    <div class="bg-blue-900 text-white w-auto inline-block px-6 font-semibold py-3 rounded-2xl shadow-md text-center font-algerian" style="background-color: #1e3a8a;">
                        UNIVERSITE AUBE NOUVELLE
                    </div>
                </div>
                 <!-- MODIFICATION: Spacer pour la barre de nav (UNIQUEMENT sur cet écran) -->
                 <div class="h-24"></div>
            </div>
            
            <!-- Bottom Navigation (DÉPLACÉ hors de cet écran) -->
        </div>

        <!-- Écran: Détails du Bloc (Dynamique) -->
        <div id="screen-blocA-details" class="hidden flex-col h-full">
            <div class="flex-shrink-0 p-4 flex justify-between items-center bg-white shadow-sm">
                 <button onclick="goBack()" class="text-gray-600"><i data-lucide="arrow-left"></i></button>
                 <h1 class="font-bold text-xl text-gray-800">&nbsp;</h1>
                 <div></div>
            </div>
            <div id="bloc-details-title" class="header-btn font-algerian">Bloc A</div>
            <!-- MODIFICATION: pb-nav supprimé -->
            <div class="main-content space-y-4">
                <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
                    <img id="bloc-details-main-image" onclick="navigateTo('screen-image-zoom')" src="https://placehold.co/400x220/6b7280/ffffff?text=Vue+A%C3%A9rienne+Bloc+A" alt="Vue aérienne Bloc A" class="w-full h-auto object-cover cursor-pointer">
                    <p id="bloc-details-main-image-title" class="text-center text-gray-600 text-sm p-2 font-monotype-corsiva">· Bloc A vu de dessus ·</p>
                </div>
                <p id="sub-bloc-title-1" class="text-center font-algerian text-blue-900 text-xl">A1</p>
                <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
                    <img id="sub-bloc-image-1" onclick="showSubBlocDetails('A1')" src="https://placehold.co/400x220/3b82f6/ffffff?text=Salles+de+Classe" alt="Salles de classe" class="w-full h-auto object-cover cursor-pointer">
                    <p id="sub-bloc-image-title-1" class="text-center text-gray-600 text-sm p-2 font-monotype-corsiva">· Salles de classe ·</p>
                </div>
                
                <p id="sub-bloc-title-2" class="text-center font-algerian text-blue-900 text-xl">A2</p>
                <div class="bg-white rounded-2xl shadow-lg overflow-hidden">
                    <img id="sub-bloc-image-2" onclick="showSubBlocDetails('A2')" src="https://placehold.co/400x220/3b82f6/ffffff?text=Bureaux" alt="Bureaux" class="w-full h-auto object-cover cursor-pointer">
                    <p id="sub-bloc-image-title-2" class="text-center text-gray-600 text-sm p-2 font-monotype-corsiva">· Bureaux ·</p>
                </div>
            </div>
        </div>
        
        <!-- Écran: Zoom Image (Dynamique) -->
        <div id="screen-image-zoom" class="hidden flex-col h-full bg-black">
            <button onclick="goBack()" class="absolute top-4 left-4 z-10 text-white bg-black/50 rounded-full p-2">
                <i data-lucide="arrow-left"></i>
            </button>
            <div class="flex-grow flex items-center justify-center">
                 <img id="zoom-image-src" src="https://placehold.co/400x600/6b7280/ffffff?text=Vue+A%C3%A9rienne+Zoom" alt="Vue aérienne Bloc A Zoom" class="w-full h-auto object-contain">
            </div>
        </div>

        <!-- Écran: Niveaux de Subdivision (Dynamique) -->
        <div id="screen-blocA1-levels" class="hidden flex-col h-full">
            <div class="flex-shrink-0 p-4 flex justify-between items-center bg-white shadow-sm">
                 <button onclick="goBack()" class="text-gray-600"><i data-lucide="arrow-left"></i></button>
                 <h1 class="font-bold text-xl text-gray-800">&nbsp;</h1>
                 <div></div>
            </div>
            <div id="levels-title" class="header-btn font-algerian">Bloc A1</div>
            <!-- MODIFICATION: pb-nav supprimé -->
            <div class="main-content">
                <div class="bg-white text-blue-900 font-semibold text-center py-3 rounded-full shadow-md mb-6 font-monotype-corsiva text-lg">
                    · NIVEAUX DE SUBDIVISION ·
                </div>
                <div class="space-y-3">
                    <button onclick="showRoomProfiles('Sous-sol')" class="nav-btn w-full font-monotype-corsiva text-lg">· Sous-sol ·</button>
                    <button onclick="showRoomProfiles('Rez-de-chaussée')" class="nav-btn w-full font-monotype-corsiva text-lg">· Rez-de-chaussée ·</button>
                    <button onclick="showRoomProfiles('Premier Niveau')" class="nav-btn w-full font-monotype-corsiva text-lg">· Premier Niveau ·</button>
                    <button onclick="showRoomProfiles('Deuxième Niveau')" class="nav-btn w-full font-monotype-corsiva text-lg">· Deuxième Niveau ·</button>
                    <button onclick="showRoomProfiles('Troisième Niveau')" class="nav-btn w-full font-monotype-corsiva text-lg">· Troisième Niveau ·</button>
                    <button onclick="showRoomProfiles('Quatrième Niveau')" class="nav-btn w-full font-monotype-corsiva text-lg">· Quatrième Niveau ·</button>
                </div>
            </div>
        </div>
        
        <!-- Écran: Profils de Salles (Dynamique) -->
        <!-- MODIFICATION: pb-nav remplacé par pb-24 (pour le bouton +) -->
        <div id="screen-sous-sol" class="hidden flex-col min-h-full pb-24">
            <div class="flex-shrink-0 p-4 flex justify-between items-center bg-white shadow-sm">
                 <button onclick="goBack()" class="text-gray-600"><i data-lucide="arrow-left"></i></button>
                 <h1 class="font-bold text-xl text-gray-800">&nbsp;</h1>
                 <div></div>
            </div>
            <div id="room-profiles-title" class="header-btn font-algerian">Sous-sol</div>
            <div class="flex-grow overflow-y-auto">
                <h3 id="room-profiles-header" class="text-lg font-monotype-corsiva text-gray-800 font-semibold px-6 mt-4 mb-2">Profils des salles</h3>
                <div class="overflow-x-auto no-scrollbar pb-4">
                    <div id="room-profiles-container" class="flex space-x-4 px-6">
                        <div class="flex-shrink-0 text-center w-24">
                            <div class="w-24 h-24 bg-gray-200 rounded-2xl shadow-md flex items-center justify-center text-gray-500 text-xs p-2">Aucune salle ajoutée</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Bouton + (fixe, mais pas la barre de nav) -->
            <button onclick="navigateTo('screen-addRoom')" class="fixed bottom-6 right-6 w-16 h-16 bg-red-500 hover:bg-red-600 rounded-full flex items-center justify-center text-white shadow-lg z-30">
                <i data-lucide="plus" class="w-8 h-8"></i>
            </button>
        </div>

        <!-- Écran: Options de la Salle (Détails) -->
        <div id="screen-room-details" class="hidden flex-col h-full">
            <div class="flex-shrink-0 p-4 flex justify-between items-center bg-white shadow-sm">
                 <button onclick="goBack()" class="text-gray-600"><i data-lucide="arrow-left"></i></button>
                 <h1 id="room-details-title" class="font-bold text-xl text-gray-800">Laboratoire</h1>
                 <div></div> <!-- Espace réservé -->
            </div>
            <div id="room-details-header" class="header-btn font-algerian">Détails du Laboratoire</div>
            <!-- MODIFICATION: pb-nav supprimé -->
            <div class="main-content flex flex-col justify-center items-center space-y-6 flex-grow">
                <button id="room-details-show-btn" onclick="showRoomContents(currentSalleId)" class="nav-btn w-3/4 text-lg mx-auto">Afficher la salle</button>
                <button id="room-details-add-btn" onclick="showCategoryList(currentSalleId)" class="nav-btn w-3/4 text-lg mx-auto">Ajouter du matériel</button>
            </div>
        </div>
        
        <!-- Écran: Contenu de la Salle (Profil) -->
        <div id="screen-room-contents" class="hidden flex-col h-full bg-gray-100">
            <div class="flex-shrink-0 p-4 flex justify-between items-center bg-white shadow-sm">
                 <button onclick="goBack()" class="text-gray-600"><i data-lucide="arrow-left"></i></button>
                 <h1 id="room-contents-header" class="font-bold text-xl text-gray-800">Contenu de: Laboratoire</h1>
                 <div></div>
            </div>
            <!-- MODIFICATION: pb-nav supprimé -->
            <div id="room-contents-container" class="main-content overflow-y-auto space-y-4">
                <p class="text-center text-gray-500 mt-10">Aucun matériel n'a été ajouté à cette salle.</p>
            </div>
        </div>

        <!-- Écran: Ajouter une salle -->
        <div id="screen-addRoom" class="hidden flex-col h-full bg-gray-100">
             <div class="flex-shrink-0 p-4 flex justify-between items-center bg-white">
                 <button onclick="goBack()" class="text-gray-600"><i data-lucide="arrow-left"></i></button>
                 <h1 class="font-bold text-xl text-gray-800">&nbsp;</h1>
                 <div></div>
            </div>
            <div class="header-btn font-algerian">Ajouter une salle</div>
            <div class="main-content space-y-6">
                <div class="bg-blue-900 rounded-2xl p-4 flex flex-col items-center justify-center h-48 text-white shadow-lg">
                    <label for="room-images-upload" class="cursor-pointer text-center">
                        <i data-lucide="camera" class="w-16 h-16 mb-2 mx-auto"></i>
                        <p class="font-medium">Insérer des images de la salle</p>
                    </label>
                    <input type="file" id="room-images-upload" accept="image/*" class="hidden" onchange="previewRoomPhoto(event)">
                </div>
                <img id="room-photo-preview" src="" alt="Aperçu" class="hidden w-full h-auto rounded-lg mt-4 object-cover">
                <div class="space-y-4">
                    <div class="flex items-center space-x-3">
                        <div class="bg-red-700 text-white text-sm font-semibold rounded-full px-4 py-2 w-28 text-center">Nom</div>
                        <input id="add-room-nom" type="text" placeholder="Nom de la salle" class="flex-grow bg-white rounded-full px-4 py-2 border-2 border-gray-200 focus:outline-none focus:border-blue-500">
                    </div>
                     <div class="flex items-center space-x-3">
                        <div class="bg-blue-900 text-white text-sm font-semibold rounded-full px-4 py-2 w-28 text-center">Emplacement</div>
                        <input id="add-room-emplacement" type="text" placeholder="Ex: A1, D1, E2..." class="flex-grow bg-white rounded-full px-4 py-2 border-2 border-gray-200 focus:outline-none focus:border-blue-500">
                    </div>
                     <div class="flex items-center space-x-3" id="add-room-niveau-row">
                        <div class="bg-red-700 text-white text-sm font-semibold rounded-full px-4 py-2 w-28 text-center">Niveau</div>
                        <input id="add-room-niveau" type="text" placeholder="Ex: Sous-sol, Premier Niveau..." class="flex-grow bg-white rounded-full px-4 py-2 border-2 border-gray-200 focus:outline-none focus:border-blue-500">
                    </div>
                </div>
                <!-- MODIFICATION: Appel async -->
                <button onclick="saveRoom()" class="nav-btn w-full mt-8">Enregistrer la salle</button>
            </div>
        </div>
        
        <!-- Écran: Catégories de Matériaux -->
        <div id="screen-categories" class="hidden flex-col h-full bg-gray-100">
             <div class="flex-shrink-0 p-4 flex justify-between items-center bg-white">
                 <button onclick="goBack()" class="text-gray-600"><i data-lucide="arrow-left"></i></button>
                 <h1 class="font-bold text-xl text-gray-800">&nbsp;</h1>
                 <div></div>
            </div>
            <div class="header-btn font-algerian">Catégories de Matériaux</div>
            <div class="main-content flex flex-col">
                <div class="relative mb-6">
                    <input type="search" id="category-search-input" placeholder="Rechercher une catégorie..." class="w-full bg-white rounded-full pl-10 pr-12 py-3 border-2 border-gray-200 focus:outline-none focus:border-blue-500">
                    <i data-lucide="search" class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 w-5 h-5"></i>
                    <button onclick="navigateTo('screen-add-category')" class="absolute right-2 top-1/2 -translate-y-1/2 text-white bg-blue-600 rounded-full p-2 hover:bg-blue-700">
                        <i data-lucide="plus" class="w-5 h-5"></i>
                    </button>
                </div>
                <div class="border-b border-gray-300 mb-4"></div>
                <div id="category-list-container" class="flex-grow overflow-y-auto space-y-3">
                    <!-- Les catégories seront injectées ici -->
                </div>
            </div>
        </div>
        
        <!-- Écran: Ajouter un Formulaire de Catégorie -->
        <div id="screen-add-category" class="hidden flex-col h-full bg-gray-100">
             <div class="flex-shrink-0 p-4 flex justify-between items-center bg-white">
                 <button onclick="goBack()" class="text-gray-600"><i data-lucide="arrow-left"></i></button>
                 <h1 class="font-bold text-xl text-gray-800">&nbsp;</h1>
                 <div></div>
            </div>
            <div class="header-btn font-algerian">Ajouter une Catégorie</div>
            <div class="main-content space-y-6">
                <input id="add-category-name" type="text" placeholder="Nom de la nouvelle catégorie" class="w-full bg-white rounded-full px-4 py-3 border-2 border-gray-200 focus:outline-none focus:border-blue-500">
                <button onclick="saveCategory()" class="nav-btn w-full">Enregistrer</button>
            </div>
        </div>
        
        <!-- Écran: Ajouter du Matériel (Formulaire) -->
        <div id="screen-add-materiel" class="hidden flex-col h-full bg-gray-100">
             <div class="flex-shrink-0 p-4 flex justify-between items-center bg-white">
                 <button onclick="goBack()" class="text-gray-600"><i data-lucide="arrow-left"></i></button>
                 <h1 id="add-materiel-header" class="font-bold text-xl text-gray-800">Ajouter: Extincteur</h1>
                 <div></div>
            </div>
            <div class="main-content overflow-y-auto space-y-4">
                <div class="bg-white p-4 rounded-lg shadow">
                    <label for="materiel-photo-camera" class="flex flex-col items-center justify-center w-full h-32 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer hover:bg-gray-50">
                        <i data-lucide="camera" class="w-12 h-12 text-gray-400"></i>
                        <span class="text-gray-500">Prendre une photo</span>
                        <input id="materiel-photo-camera" type="file" accept="image/*" capture="environment" class="hidden" onchange="previewMaterielPhoto(event)">
                    </label>
                    <p class="text-center text-gray-500 my-2">ou</p>
                    <label for="materiel-photo-gallery" class="flex flex-col items-center justify-center w-full h-24 border-2 border-gray-300 border-dashed rounded-lg cursor-pointer hover:bg-gray-50">
                        <i data-lucide="image" class="w-10 h-10 text-gray-400"></i>
                        <span class="text-gray-500">Choisir de la gallerie</span>
                        <input id="materiel-photo-gallery" type="file" accept="image/*" class="hidden" onchange="previewMaterielPhoto(event)">
                    </label>
                    <img id="materiel-photo-preview" src="" alt="Aperçu" class="hidden w-full h-auto rounded-lg mt-4 object-cover">
                    <!-- MODIFICATION: Bouton pour supprimer la photo -->
                    <button id="materiel-remove-photo-btn" onclick="removeMaterielPhoto()" class="hidden w-full mt-2 text-sm text-red-600 hover:text-red-800">Supprimer la photo</button>
                </div>
                
                <div class="bg-white p-4 rounded-lg shadow space-y-4">
                    <div>
                        <label for="materiel-nom" class="text-sm font-medium text-gray-700">Nom du matériel</label>
                        <input id="materiel-nom" type="text" class="mt-1 w-full bg-gray-50 rounded-full px-4 py-2 border-2 border-gray-200 focus:outline-none focus:border-blue-500">
                    </div>
                    <div>
                        <label for="materiel-marque" class="text-sm font-medium text-gray-700">Marque</label>
                        <input id="materiel-marque" type="text" class="mt-1 w-full bg-gray-50 rounded-full px-4 py-2 border-2 border-gray-200 focus:outline-none focus:border-blue-500">
                    </div>
                    <div>
                        <label for="materiel-couleur" class="text-sm font-medium text-gray-700">Couleur</label>
                        <input id="materiel-couleur" type="text" class="mt-1 w-full bg-gray-50 rounded-full px-4 py-2 border-2 border-gray-200 focus:outline-none focus:border-blue-500">
                    </div>
                    <div>
                        <label for="materiel-etat" class="text-sm font-medium text-gray-700">État</label>
                        <select id="materiel-etat" class="mt-1 w-full bg-gray-50 rounded-full px-4 py-2 border-2 border-gray-200 focus:outline-none focus:border-blue-500">
                            <option>Neuf</option>
                            <option>Bon</option>
                            <option>Usé</option>
                            <option>Défectueux</option>
                        </select>
                    </div>
                    <div>
                        <label for="materiel-date-acq" class="text-sm font-medium text-gray-700">Date d'acquisition</label>
                        <input id="materiel-date-acq" type="date" class="mt-1 w-full bg-gray-50 rounded-full px-4 py-2 border-2 border-gray-200 focus:outline-none focus:border-blue-500">
                    </div>
                    <div>
                        <label for="materiel-date-ren" class="text-sm font-medium text-gray-700">Date de renouvellement conseillée</label>
                        <input id="materiel-date-ren" type="date" class="mt-1 w-full bg-gray-50 rounded-full px-4 py-2 border-2 border-gray-200 focus:outline-none focus:border-blue-500">
                    </div>
                    <div>
                        <label for="materiel-infos" class="text-sm font-medium text-gray-700">Informations supplémentaires</label>
                        <textarea id="materiel-infos" rows="3" class="mt-1 w-full bg-gray-50 rounded-2xl px-4 py-2 border-2 border-gray-200 focus:outline-none focus:border-blue-500"></textarea>
                    </div>
                </div>
                <!-- MODIFICATION: Appel async -->
                <button onclick="saveMateriel()" class="nav-btn w-full !bg-red-700 hover:!bg-red-800">Enregistrer le matériel</button>
            </div>
        </div>

        <!-- Écran: Notifications (DEVIENT ÉCRAN D'ALERTES) -->
        <!-- MODIFICATION: pb-nav supprimé -->
        <div id="screen-alerts" class="hidden flex-col h-full bg-gray-100">
            <div class="flex-shrink-0 p-4 flex justify-between items-center bg-white shadow-sm">
                 <button onclick="goBack()" class="text-gray-600"><i data-lucide="arrow-left"></i></button>
                 <h1 class="font-bold text-xl text-gray-800 font-algerian">Alertes & Avertissements</h1>
                 <div class="w-6"></div> <!-- Spacer -->
            </div>
            <div id="alerts-container" class="flex-grow overflow-y-auto p-4 space-y-3">
                <!-- Les alertes seront injectées ici -->
                <p class="text-center text-gray-500 mt-10">Aucune alerte pour le moment.</p>
            </div>
        </div>
        
        <!-- Écran: Chat "Aube" -->
        <div id="screen-chat-aube" class="hidden flex-col h-full bg-gray-200">
            <div class="flex-shrink-0 p-3 flex items-center bg-white shadow-md">
                 <button onclick="goBack()" class="text-gray-600 mr-2"><i data-lucide="arrow-left"></i></button>
                 <div class="w-10 h-10 rounded-full bg-blue-600 flex items-center justify-center text-white mr-3 flex-shrink-0">
                     <i data-lucide="bot"></i>
                 </div>
                 <h1 class="font-bold text-lg text-gray-800">Aube</h1>
                 <div class="flex-grow"></div>
                 <button class="text-gray-600 ml-2"><i data-lucide="more-vertical"></i></button>
            </div>
            <div id="aube-chat-messages" class="flex-grow overflow-y-auto p-4 space-y-3">
                <div class="p-3 rounded-lg max-w-xs shadow" style="background-color: #F8BBD0; margin-right: auto;">
                    <p>Bonjour ! Je suis Aube, votre assistant. Comment puis-je vous aider ?</p>
                </div>
            </div>
            <div class="flex-shrink-0 p-2 bg-white flex items-center">
                <input id="aube-chat-input" type="text" placeholder="Envoyer un message à Aube..." class="flex-grow bg-gray-100 rounded-full px-4 py-2 border-2 border-transparent focus:outline-none focus:border-blue-500">
                <button id="aube-chat-send-btn" class="bg-blue-600 text-white rounded-full w-10 h-10 flex items-center justify-center ml-2 flex-shrink-0">
                    <i data-lucide="send" class="w-5 h-5"></i>
                </button>
            </div>
        </div>

        <!-- NOUVEL Écran: Notes (Style amélioré) -->
        <!-- MODIFICATION: pb-nav supprimé -->
        <div id="screen-notes" class="hidden flex-col h-full bg-gradient-to-br from-blue-50 to-indigo-100">
            <div class="flex-shrink-0 p-4 flex justify-between items-center bg-white shadow-sm">
                 <button onclick="goBack()" class="text-gray-600"><i data-lucide="arrow-left"></i></button>
                 <h1 class="font-bold text-xl text-gray-800 font-algerian">Notes</h1>
                 <button onclick="createNewNote()" class="text-blue-600"><i data-lucide="plus-circle" class="w-7 h-7"></i></button>
            </div>
            <div class="p-4 flex-shrink-0">
                <div class="relative">
                    <input type="search" id="note-search-input" placeholder="Rechercher une note..." class="w-full bg-white rounded-full pl-10 pr-4 py-2 border-2 border-gray-200 focus:outline-none focus:border-blue-500 shadow-inner">
                    <i data-lucide="search" class="absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 w-5 h-5"></i>
                </div>
            </div>
            <div id="notes-list-container" class="main-content overflow-y-auto p-4 pt-0 space-y-4"> <!-- MODIFICATION: pt-0 -->
                <!-- Les notes seront injectées ici -->
                <p id="no-notes-placeholder" class="text-center text-gray-500 mt-10">Aucune note. Cliquez sur '+' pour en créer une.</p>
            </div>
        </div>
        
        <!-- NOUVEL Écran: Éditeur de Note (Style amélioré) -->
        <div id="screen-note-editor" class="hidden flex-col h-full bg-gradient-to-br from-white to-gray-50">
            <div class="flex-shrink-0 p-4 flex justify-between items-center bg-white shadow-md">
                 <button onclick="goBack()" class="text-gray-600"><i data-lucide="arrow-left"></i></button>
                 <div>
                    <button onclick="deleteCurrentNote()" class="text-red-500 mr-4 p-2 rounded-full hover:bg-red-100"><i data-lucide="trash-2"></i></button>
                    <button onclick="saveCurrentNote()" class="text-blue-600 p-2 rounded-full hover:bg-blue-100"><i data-lucide="check-circle"></i></button>
                 </div>
            </div>
            <div class="flex-grow flex flex-col p-4">
                <input id="note-editor-title" type="text" placeholder="Titre de la note..." class="text-2xl font-bold w-full p-2 focus:outline-none mb-4 border-b-2 border-gray-100 pb-4 bg-transparent">
                <textarea id="note-editor-content" placeholder="Commencez à écrire..." class="flex-grow w-full p-2 focus:outline-none text-lg resize-none bg-transparent"></textarea>
            </div>
        </div>

        <!-- Écran: Paramètres -->
        <div id="screen-settings" class="hidden flex-col h-full bg-gray-50">
            <div class="flex-shrink-0 p-4 flex justify-between items-center border-b">
                 <h1 class="font-bold text-xl text-gray-800 font-algerian">Paramètres</h1>
                 <button onclick="goBack()" class="text-gray-600"><i data-lucide="x"></i></button>
            </div>
            <div class="main-content text-gray-700 space-y-6 overflow-y-auto">
                 <details class="bg-white rounded-lg shadow" open>
                    <summary class="p-4 font-semibold cursor-pointer">Général</summary>
                     <div class="p-4 border-t">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Changer l'image de l'université</label>
                        <input type="file" id="main-building-image-upload" accept="image/*" class="input-file-style"/>
                    </div>
                     <div class="p-4 border-t">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Changer l'arrière-plan de l'accueil</label>
                        <input type="file" id="main-bg-upload" accept="image/*" class="input-file-style"/>
                    </div>
                    <div class="p-4 border-t">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Changer l'icône de l'application</label>
                        <input type="file" id="app-icon-upload" accept="image/*" class="input-file-style"/>
                    </div>
                </details>

                 <details class="bg-white rounded-lg shadow">
                    <summary class="p-4 font-semibold cursor-pointer">Menu Latéral</summary>
                     <div class="p-4 border-t">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Changer l'arrière-plan du menu</label>
                        <input type="file" id="menu-bg-upload" accept="image/*" class="input-file-style"/>
                    </div>
                     <div class="p-4 border-t">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Changer le logo du menu</label>
                        <input type="file" id="menu-logo-upload" accept="image/*" class="input-file-style"/>
                    </div>
                </details>

                <details class="bg-white rounded-lg shadow">
                    <summary class="p-4 font-semibold cursor-pointer">Personnalisation des Blocs</summary>
                    <!-- Blocs A, B, C -->
                    <div class="p-4 border-t"><h4 class="font-semibold text-lg mb-2">Bloc A</h4>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Image Vue Aérienne (A)</label>
                        <input type="file" id="setting-img-bloc-A" accept="image/*" class="input-file-style"/>
                        <label class="block text-sm font-medium text-gray-700 mt-4 mb-2">Image Sous-Bloc (A1)</label>
                        <input type="file" id="setting-img-A1" accept="image/*" class="input-file-style"/>
                        <label class="block text-sm font-medium text-gray-700 mt-4 mb-2">Image Sous-Bloc (A2)</label>
                        <input type="file" id="setting-img-A2" accept="image/*" class="input-file-style"/>
                    </div>
                    <div class="p-4 border-t"><h4 class="font-semibold text-lg mb-2">Bloc B</h4>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Image Vue Aérienne (B)</label>
                        <input type="file" id="setting-img-bloc-B" accept="image/*" class="input-file-style"/>
                        <label class="block text-sm font-medium text-gray-700 mt-4 mb-2">Image Sous-Bloc (B1)</label>
                        <input type="file" id="setting-img-B1" accept="image/*" class="input-file-style"/>
                        <label class="block text-sm font-medium text-gray-700 mt-4 mb-2">Image Sous-Bloc (B2)</label>
                        <input type="file" id="setting-img-B2" accept="image/*" class="input-file-style"/>
                    </div>
                    <div class="p-4 border-t"><h4 class="font-semibold text-lg mb-2">Bloc C</h4>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Image Vue Aérienne (C)</label>
                        <input type="file" id="setting-img-bloc-C" accept="image/*" class="input-file-style"/>
                        <label class="block text-sm font-medium text-gray-700 mt-4 mb-2">Image Sous-Bloc (C1)</label>
                        <input type="file" id="setting-img-C1" accept="image/*" class="input-file-style"/>
                        <label class="block text-sm font-medium text-gray-700 mt-4 mb-2">Image Sous-Bloc (C2)</label>
                        <input type="file" id="setting-img-C2" accept="image/*" class="input-file-style"/>
                    </div>
                    <!-- Bloc D -->
                    <div class="p-4 border-t"><h4 class="font-semibold text-lg mb-2">Bloc D</h4>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Image Vue Aérienne (D)</label>
                        <input type="file" id="setting-img-bloc-D" accept="image/*" class="input-file-style"/>
                        <label class="block text-sm font-medium text-gray-700 mt-4 mb-2">Image Sous-Bloc (D1)</label>
                        <input type="file" id="setting-img-D1" accept="image/*" class="input-file-style"/>
                         <label class="block text-sm font-medium text-gray-700 mt-4 mb-2">Image Sous-Bloc (D2)</label>
                        <input type="file" id="setting-img-D2" accept="image/*" class="input-file-style"/>
                    </div>
                    <!-- Bloc E -->
                    <div class="p-4 border-t"><h4 class="font-semibold text-lg mb-2">Bloc E</h4>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Image Vue Aérienne (E)</label>
                        <input type="file" id="setting-img-bloc-E" accept="image/*" class="input-file-style"/>
                        <label class="block text-sm font-medium text-gray-700 mt-4 mb-2">Image Sous-Bloc (E1 - Toilettes)</label>
                        <input type="file" id="setting-img-E1" accept="image/*" class="input-file-style"/>
                        <label class="block text-sm font-medium text-gray-700 mt-4 mb-2">Image Sous-Bloc (E2 - Jardins)</label>
                        <input type="file" id="setting-img-E2" accept="image/*" class="input-file-style"/>
                    </div>
                    <!-- Bloc F -->
                     <div class="p-4 border-t">
                        <h4 class="font-semibold text-lg mb-2">Bloc F</h4>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Image Vue Aérienne (F)</label>
                        <input type="file" id="setting-img-bloc-F" accept="image/*" class="input-file-style"/>
                    </div>
                </details>
                
                <details class="bg-white rounded-lg shadow">
                    <summary class="p-4 font-semibold cursor-pointer">Base de Connaissances Aube</summary>
                     <div class="p-4 border-t">
                        <label for="aube-kb" class="block text-sm font-medium text-gray-700 mb-2">Informations pour le bot</label>
                        <textarea id="aube-kb" rows="4" class="w-full p-2 border border-gray-300 rounded-lg" placeholder="Glissez des informations ici..."></textarea>
                        <button onclick="saveAubeKb()" class="mt-2 w-full bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">Sauvegarder</button>
                    </div>
                </details>

                 <details class="bg-white rounded-lg shadow">
                    <summary class="p-4 font-semibold cursor-pointer">Documents</summary>
                     <div class="p-4 border-t">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Charger le guide d'utilisation (PDF)</label>
                        <input type="file" id="guide-pdf-upload" accept=".pdf" class="input-file-style"/>
                    </div>
                     <div class="p-4 border-t">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Charger "A propos du développeur" (PDF)</label>
                        <input type="file" id="dev-pdf-upload" accept=".pdf" class="input-file-style"/>
                    </div>
                </details>

                 <details class="bg-white rounded-lg shadow">
                    <summary class="p-4 font-semibold cursor-pointer">Données</summary>
                     <div class="p-4 border-t">
                        <label class="block text-sm font-medium text-gray-700 mb-2">Données essentielles</label>
                        <button id="download-data" class="w-full bg-green-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-green-700">Télécharger les données (.csv)</button>
                    </div>
                </details>
            </div>
        </div>
        
        <!-- Écran: Visionneuse PDF - Guide -->
        <div id="screen-guide" class="hidden flex-col h-full">
            <div class="flex-shrink-0 p-4 flex justify-between items-center bg-white shadow-sm">
                <button onclick="toggleMenu()" class="text-gray-600"><i data-lucide="arrow-left"></i></button>
                <h1 class="font-bold text-lg text-gray-800">Guide d'utilisation</h1>
                <div></div>
            </div>
            <div class="flex-grow flex items-center justify-center">
                <embed id="guide-pdf-viewer" src="" type="application/pdf" width="100%" height="100%">
                <p id="guide-pdf-placeholder" class="text-gray-500">Aucun guide n'a été chargé.</p>
            </div>
        </div>

        <!-- Écran: Visionneuse PDF - Dev -->
        <div id="screen-about-dev" class="hidden flex-col h-full">
            <div class="flex-shrink-0 p-4 flex justify-between items-center bg-white shadow-sm">
                <button onclick="toggleMenu()" class="text-gray-600"><i data-lucide="arrow-left"></i></button>
                <h1 class="font-bold text-lg text-gray-800">A propos du développeur</h1>
                <div></div>
            </div>
            <div class="flex-grow flex items-center justify-center">
                <embed id="dev-pdf-viewer" src="" type="application/pdf" width="100%" height="100%">
                 <p id="dev-pdf-placeholder" class="text-gray-500">Aucun document n'a été chargé.</p>
            </div>
        </div>
        
        <!-- MODIFICATION: Barre de navigation DÉPLACÉE ICI, à l'extérieur des écrans -->
        <div id="bottom-nav-bar" class="absolute bottom-4 left-1/2 -translate-x-1/2 w-[calc(100%-2rem)] z-20">
            <div class="bg-blue-900 text-white rounded-full flex justify-around items-center h-16 shadow-lg" style="background-color: #1e3a8a;">
                <button onclick="navigateTo('screen-alerts')" class="p-4 opacity-70 hover:opacity-100 transition-opacity relative">
                    <i data-lucide="bell"></i>
                    <span id="notification-dot" class="absolute top-3 right-3 w-3 h-3 bg-red-500 rounded-full border-2 border-blue-900 hidden"></span>
                </button>
                <!-- MODIFICATION: Ajout d'ID et gestion de l'opacité -->
                <button onclick="navigateTo('screen-blocA')" class="p-4 opacity-100" id="nav-home-btn"><i data-lucide="home"></i></button>
                <button onclick="navigateTo('screen-notes')" class="p-4 opacity-70 hover:opacity-100 transition-opacity" id="nav-notes-btn"><i data-lucide="file-text"></i></button>
            </div>
        </div>

    </div> <!-- Fin de main-app-container -->

    <!-- Menu Latéral -->
     <div id="menu-container" class="fixed inset-0 z-40 transform -translate-x-full transition-transform duration-300">
        <div id="menu-background" class="absolute inset-0"></div>
        <div id="side-menu" class="relative w-72 h-full text-white p-6 flex flex-col shadow-2xl">
            <div class="flex justify-between items-center border-b pb-2 mb-8">
                <h2 class="text-xl font-bold font-algerian">U-AUBEN Supplies Tracker</h2>
                <button onclick="toggleMenu()" class="text-white"><i data-lucide="x"></i></button>
            </div>
            <nav class="space-y-4 flex flex-col flex-grow text-lg font-monotype-corsiva">
                <a href="#" onclick="loadAndShowPdf('guidePdfUrl', 'screen-guide', 'guide-pdf-viewer', 'guide-pdf-placeholder')" class="hover:bg-white/10 p-2 rounded-md text-center">· Guide d’utilisation de l’application ·</a>
                <a href="#" onclick="loadAndShowPdf('devPdfUrl', 'screen-about-dev', 'dev-pdf-viewer', 'dev-pdf-placeholder')" class="hover:bg-white/10 p-2 rounded-md text-center">· A propos du développeur ·</a>
                <a href="#" onclick="document.getElementById('download-data').click()" class="hover:bg-white/10 p-2 rounded-md text-center">· Données essentielles ·</a>
                <div class="flex-grow"></div>
                <div class="text-center text-gray-300 p-2">· Version 1.1.1 ·</div>
                <div class="text-center p-4">
                    <img id="menu-logo-image" src="https://placehold.co/80x80/ffffff/7f1d1d?text=Logo" class="mx-auto w-16 h-16 rounded-full">
                </div>
            </nav>
        </div>
    </div>
    <div id="menu-overlay" class="fixed inset-0 bg-black/50 z-30 hidden" onclick="toggleMenu()"></div>
    <!-- Password Modal -->
    <div id="password-modal" class="fixed inset-0 bg-black/60 z-50 hidden items-center justify-center">
    <div class="bg-white rounded-lg shadow-xl p-6 w-80">
        <h3 class="text-lg font-bold mb-4 text-center">Accès administrateur</h3>
        <p class="text-sm text-gray-600 mb-4 text-center">Veuillez entrer le mot de passe pour accéder aux paramètres.</p>
        <input type="password" id="password-input" class="w-full border-2 border-gray-300 rounded-lg px-4 py-2 mb-4 focus:outline-none focus:border-blue-500">
        <p id="password-error" class="text-red-500 text-xs text-center mb-4 hidden">Mot de passe incorrect.</p>
        <div class="flex justify-between">
            <button onclick="hidePasswordPrompt()" class="bg-gray-300 text-gray-800 font-bold py-2 px-4 rounded-lg hover:bg-gray-400">Annuler</button>
            <button onclick="checkPassword()" class="bg-blue-600 text-white font-bold py-2 px-4 rounded-lg hover:bg-blue-700">Valider</button>
        </div>
    </div>
</div>

<script src="js/db.js"></script>

  <script>
    // Configuration Tailwind
    tailwind.config = {
      theme: { extend: { colors: { 'aube-red': '#b91c1c', 'aube-blue': '#1e3a8a' } } }
    }

    // GESTION DE LA NAVIGATION
    let navigationHistory = ['screen-home']; 

    function showScreen(screenId, saveHistory = true) {
        console.log("Navigation vers :", screenId);
        const allScreens = document.querySelectorAll('.main-container > div');
        allScreens.forEach(s => s.classList.add('hidden'));

        const target = document.getElementById(screenId);
        if (target) {
            target.classList.remove('hidden');
            if (saveHistory && navigationHistory[navigationHistory.length - 1] !== screenId) {
                navigationHistory.push(screenId);
            }
            window.scrollTo(0, 0);
        } else {
            console.error("Écran introuvable : " + screenId);
        }
    }

    // Fonctions liées à tes boutons onclick
    function showBlocDetails(letter) { showScreen('screen-bloc' + letter + '-details'); }
    function showSubBlocDetails(id) { showScreen('screen-bloc' + id + '-levels'); }
    function navigateTo(id) { showScreen(id); }
    
    function goBack() {
        if (navigationHistory.length > 1) {
            navigationHistory.pop(); // Retire l'écran actuel
            const prevScreen = navigationHistory[navigationHistory.length - 1];
            showScreen(prevScreen, false);
        } else {
            showScreen('screen-home', false);
        }
    }

    // GESTION DU MENU LATÉRAL (Pour tes fonctions toggleMenu)
    function toggleMenu(isOpen) {
        const sideMenu = document.getElementById('side-menu');
        const menuOverlay = document.getElementById('menu-overlay');
        if (sideMenu && menuOverlay) {
            if (isOpen) {
                sideMenu.style.transform = 'translateX(0)';
                menuOverlay.classList.remove('hidden');
            } else {
                sideMenu.style.transform = 'translateX(-100%)';
                menuOverlay.classList.add('hidden');
            }
        }
    }

    // INITIALISATION
    document.addEventListener('DOMContentLoaded', () => {
        if (window.lucide) { window.lucide.createIcons(); }
        // On s'assure d'afficher l'accueil (screen-home) au démarrage
        showScreen('screen-home', false);
    });
  </script>
  
<style>
.input-file-style {
    @apply block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100;
}
details > summary { list-style: none; }
details > summary::-webkit-details-marker { display: none; }
details > summary::after {
    content: '+';
    float: right;
    font-size: 1.5em;
    line-height: 1;
    font-weight: bold;
    color: #3b82f6; /* blue-500 */
}
details[open] > summary::after { content: '−'; }
#aube-chat-messages {
    display: flex;
    flex-direction: column;
    gap: 0.75rem; /* space-y-3 */
}
</style>
</body>

</html>

















